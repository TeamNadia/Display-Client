<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  
  <style>
    body
    {
      padding-top: 20px;
    }
    #ScreenName
    {
      font-weight: bold;
    }
    #TrackListingTable
    {
      border-width: 0;
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-2">
      <h3 class="text-center">Welcome to <span id="ScreenLocation"></span></h3>
      <br>
      Your screen is <span id="ScreenName"></span>.
      <br>
      Use the PIN <span id="ScreenPIN"></span> to control this screen.
      <br>
      <table id="TrackListingTable"></table>
    </div>
    <div class="col-sm-10">
      <div class="embed-responsive embed-responsive-16by9"> <!-- sets the aspect ratio of the video-->
        <iframe class="embed-responsive-item" src="http://www.youtube.com/embed/ePbKGoIGAXY"></iframe> 
      </div>
    </div>
  </div>
</div>

<!-- Load the JavaScript at the bottom of the page so that it loads faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.getUrlParam.js"></script>
<script>
  var isUpdatingTrackListing = false;
  var screenId = $(document).getUrlParam("screen");
    
  function updateTrackListing()
  {
    if (isUpdatingTrackListing == true)
      return;
      
    isUpdatingTrackListing = true;
    
    $.get("/Server/getsongs.php?screen=" + screenId, function(data)
    {
      var obj = JSON.parse(data);
      var i;
      var table = $("#TrackListingTable");
      var newTableHtml = "";
      for (i = 0; i < obj.length; i++)
      {
        newTableHtml += '<tr><td><img src="' + obj['thumbnail'] + '"></td><td><span style="font-weight: bold;">' + obj['artist']
        + '</span><br>' + obj['track'];
      }
      
      if (newTableHtml != table.html())
      {
        table.html(newTableHtml)
      }
      
      isUpdatingTrackListing = false;
    });
  }
  
  $.get("/Server/getscreens.php?showpin=1", function(data)
  {
    var obj = JSON.parse(data);
    var i, screenData;
    for (i = 0; i < obj.length; i++)
    {
      if (obj[i]['id'] == screenId)
      {
        screenData = obj[i];
      }
    }
    
    $("#ScreenName").html(screenData['name']);
    $("#ScreenLocation").html(screenData['location']);
    $("#ScreenPIN").html(screenData['pin']);
    
    setInterval(updateTrackListing, 2000);
  });
</script>
</body>
</html>
